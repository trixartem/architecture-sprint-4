## Выбор и настройка мониторинга в системе

### Мотивация
1. Улучшает видимость системы. Позволят наблюдать за системой, как она себя ведет в разных ситауциях и проводить анализ
2. Повышает надежность системы. Позволит находить в системе узкие и проблемые места, позволит действовать превентивно
3. Увеличение скорость реагирования на проблемы. Позволит быстрее обнаружить проблемы, предотвратить их
4. Позволит бизнесу принимать решения и планировать развитие на основе текущего состояния системы

## Выбор подхода к мониторингу
- RED (Rate Request Duration) - Важны для конечных пользователей. Не подходит для потоковой обработки
- USE(Utilization Saturation Errors) - Работает с ресурсами. Серверы и инструменты. Плохо для кэширования
- 4 золотых сигнала (Задержка Трафик Ошибки Насыщенность) - лучше всего подходит для API

**Разделим все сервисы на несколько категорий:**
1. WEB-сервисы: InternetShop, CRM, MES
2. API: ShopAPI, CRMAPI, MESAPI
3. DB: ShopDB, MessageQueue, MesDB, S3

Для всех web-сервисов лучше использовать RED, что бы изменрять нагрузку и вермя ответа

Для всех API можно применить 4 золотых сигнала, что бы отследить трафик, ошибки и нагруженность по ресурсам

Для БД, s3, очередеи лучше подходит USE, что бы следить за утилизацией ресурсов, а так же нагрузку

### Метрики
**Для серверов shop api, mes api, crm api:**
1. CPU % - позволит измерить насыщенность использовать CPU
2. Memory Utilisation - позволит измерить насыщенность использовать памяти
3. Number of HTTP 200 - позволит увидеть число успешных запросов
4. Number of HTTP 500  - позволит увидеть число упавших запросов. Можно поставить алерт про появлении таких запросов
5. Response time (latency) - задержка в запросах тоже может подсветить проблему долгих запросов, а значит проблемы с серверами
6. Number of requests (RPS) - позволит увидеть число запросов на сервер

**Для web-сервисов internet shop, CRM, MES:**

Number of requests (RPS) per user - количество запросов на сервис для каждого пользовател. Позволит увидеть изменения трафика

**S3**

Size of S3 storage - самый главный показатель, что бы измерять оставшееся место в S3 хранилище

**DB**
1. Size db instance - что бы измерять оставшееся место в БД
2. Number of connections db instance - измерять число соединий к БД. Про резком росте могут возникать проблемы в скорости работы
3. Memory Utilisation db instance - измерение утилизации памяти, помогает понять, когда БД не справляется

**MessageQueue**
1. Number of dead-letter-exchange letters in RabbitMQ - Важный показатель, который показывает количество недоставленных сообщений. Говорит о проблеме в системе, возможно пользователи не получают обновления статусов
2. Number of message in flight in RabbitMQ - количество сообщений в очереди. Поможет увидеть изменения в нагрузе и задержке в обработке

### План действий
1. Настроить Prometheus
	- Поднимаем в докере Prometheus
	- Настраиваем сбор метрик
2. Поднять и настроить Grafana
	- Поднять отдельный инстанс графаны
	- Указать источник данных
3. Настроить необходимые мониторинги и алерты